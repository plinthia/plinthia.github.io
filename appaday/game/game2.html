<!DOCTYPE html>
<head>
<title> Mouse Game</title>
<style>
canvas {background: #eee; display: block; margin:0 auto;}
body{
	background-color:#666699;
	text-align:center;
	font-family: "helvetica";
	color:#00ccff;
}
</style>
</head>
<body>
<div id="instructions"></div>
<canvas id="myCanvas" width="500" height="350"></canvas>
<div id="test"></div>

<script>
var canvas=document.getElementById("myCanvas");
ctx=canvas.getContext("2d");

var characterHeight=50;
var characterWidth=50;
var cheeseHeight=50;
var cheeseWidth=50;
var boardHeight=50;
var boardWidth=50;
var lev=0;
var rightPressed=false;
var leftPressed=false;
var downPressed=false;
var upPressed=false;
var resetPressed=false;



var board={
	"levels":[{
			"level":1,
			"boardX":[],
			"boardY":[],
			"cheeseX":450,
			"cheeseY":100,
			"charX":0,
			"charY":0,
			"instructions":"You are a little red mouse, who wants to get the cheese. Use your cursor keys to navigate to the cheese."
		},
		{
			"level":2,
			"boardX":[100,50,0],
			"boardY":[0,200,250],
			"cheeseX":450,
			"cheeseY":200,
			"charX":0,
			"charY":0,
			"instructions":"Good job! If your mouse hits an obstacle he will stop! Navigate around the obstacles to get the cheese!"
		},
		{
			"level":3,
			"boardX":[400,350,50,100],
			"boardY":[0,200,150,50],
			"cheeseX":200,
			"cheeseY":100,
			"charX":0,
			"charY":0,
			"instructions":"You can use the obstacles to help position your mouse to help get the cheese."
		}]
}
var pos = board.levels[lev];


document.addEventListener("keydown",keyDownHandler,false);

function keyDownHandler(e){
	if(! (rightPressed || leftPressed || downPressed || upPressed)){
		if(e.keyCode==39){
			rightPressed=true;
		}else if(e.keyCode==37){
			leftPressed=true;
		}else if(e.keyCode==38){
			upPressed=true;
		}else if(e.keyCode==40){
			downPressed=true;
		}else if(e.keyCode==13){
			resetPressed==true;
		}
	}
}


function drawCharacter(){
	ctx.beginPath();
	ctx.rect(pos.charX,pos.charY,characterWidth,characterHeight);
	ctx.fillStyle="red";
	ctx.fill();
	ctx.closePath();
}


function drawBoard(){
	for(i=0; i<pos.boardX.length; i++){
		ctx.beginPath();
		ctx.rect(pos.boardX[i], pos.boardY[i], boardWidth, boardHeight);
		ctx.fillStyle="black";
		ctx.fill();
		ctx.closePath();
	}
}

function drawCheese(){
	ctx.beginPath();
	ctx.rect(pos.cheeseX, pos.cheeseY,cheeseWidth,cheeseHeight);
	ctx.fillStyle="yellow";
	ctx.fill();
	ctx.closePath();
}

function cheeseDetector(){
	if(pos.charX==pos.cheeseX && pos.charY==pos.cheeseY){
		alert("Congrats, next level.");
		//document.location.reload();
		lev++;
		rightPressed=false;
		leftPressed=false;
		downPressed=false;
		upPressed=false;
		pos=board.levels[lev];

	}
}

function characterMove(){
	var xMove=0;
	var	yMove=0;
	if(rightPressed){
			xMove=5;
		}
		else if (leftPressed){
			xMove=-5;
		}
		else if(downPressed){
			yMove=5;
		}
		else if(upPressed){
			yMove=-5;
		}
	var newX = pos.charX + xMove;
	var newY = pos.charY + yMove;
	boardDetector(newX,newY);
	wallDetector();
}

function boardDetector(x,y){
	for(j=0; j<pos.boardX.length; j++){
		if(x + characterWidth > pos.boardX[j] && x<pos.boardX[j] + boardWidth && y +characterHeight > pos.boardY[j] && y< pos.boardY[j] + boardHeight){
					rightPressed=false;
					leftPressed=false;
					upPressed=false;
					downPressed=false;
				}
	}
	
}



function wallDetector(){
	if(rightPressed){
		if(pos.charX>=canvas.width-characterWidth){
				rightPressed=false;
			}
		else if(pos.charX<canvas.width-characterWidth){
			pos.charX+=5;
			}
	}
	else if(leftPressed){
		if(pos.charX<=0){
			leftPressed=false;
		}
		else if(pos.charX>0){ 
		pos.charX-=5;
		}
	}
	else if(downPressed){
		if(pos.charY>=canvas.height-characterHeight){
				downPressed=false;
			}
		else if(pos.charY<canvas.height-characterHeight){
			pos.charY+=5;
			}
	}
	else if(upPressed){
		if(pos.charY<=0){
			upPressed=false;
		}
		else if(pos.charY>0){ 
		pos.charY-=5;
	}
	}
}

function endDetector(){
	if(lev==board.levels.length){
		alert("You are out of levels. Press OK to start again.");
		document.location.reload();
	}
}

function drawLevel(){
	document.getElementById("test").innerHTML="Level: " + pos.level;
}

function drawInstructions(){
	if(pos.instructions){
		document.getElementById("instructions").innerHTML=pos.instructions;
	}else{
		document.getElementById("instructions").innerHTML=" "
	}
}

function resetLevel(){
	if(resetPressed){
		//drawBoard();
		resetPressed=false;
console.log("reset");
	}
}
function draw(){
	ctx.clearRect(0,0,canvas.width,canvas.height);
	characterMove();
	drawCharacter();
	drawCheese();
	drawBoard();
	cheeseDetector();
	endDetector();
	drawLevel();
	drawInstructions();
	resetLevel();

}

setInterval(draw,10);
</script>
</body>